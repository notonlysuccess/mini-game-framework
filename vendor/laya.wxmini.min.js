!function(n,e,t){t.un,t.uns;var i=t.static,o=t.class,a=t.getset,l=(t.__newvec,laya.utils.Browser),r=(laya.events.Event,laya.events.EventDispatcher),u=laya.resource.HTMLImage,s=laya.utils.Handler,d=laya.display.Input,c=laya.net.Loader,f=(laya.maths.Matrix,laya.renders.Render),p=laya.utils.RunDriver,h=laya.media.SoundChannel,v=laya.media.SoundManager,m=laya.display.Stage,g=laya.net.URL,_=laya.utils.Utils,w=function(){function e(){}return o(e,"laya.wx.mini.MiniAdpter"),e.getJson=function(n){return JSON.parse(n)},e.init=function(){e._inited||(e._inited=!0,e.window=n,e.EnvConfig={},F.setNativeFileDir("/layaairGame"),F.existDir(F.fileNativeDir,null),m._wgColor=[0,0,0,1],e.window.focus=function(){},t.getUrlPath=function(){},e.window.CanvasRenderingContext2D=function(){},e.window.CanvasRenderingContext2D.prototype=e.window.wx.createCanvas().getContext("2d").__proto__,e.window.document.body.appendChild=function(){},e.EnvConfig.pixelRatioInt=0,p.getPixelRatio=e.pixelRatio,e._preCreateElement=l.createElement,l.createElement=e.createElement,p.createShaderCondition=e.createShaderCondition,_.parseXMLFromString=e.parseXMLFromString,d._createInputElement=x._createInputElement,e.EnvConfig.load=c.prototype.load,c.prototype.load=C.prototype.load,c.prototype._loadImage=y.prototype._loadImage)},e.pixelRatio=function(){if(!e.EnvConfig.pixelRatioInt)try{var n=wx.getSystemInfoSync();return e.EnvConfig.pixelRatioInt=n.pixelRatio,(n=n).pixelRatio}catch(n){}return e.EnvConfig.pixelRatioInt},e.createElement=function(t){if("canvas"==t){var i;return i=1==e.idx?n.canvas:n.wx.createCanvas(),e.idx++,i}if("textarea"==t||"input"==t)return e.onCreateInput(t);if("div"==t){var o=e._preCreateElement(t);return o.contains=function(n){return null},o.removeChild=function(n){},o}return e._preCreateElement(t)},e.onCreateInput=function(n){var t=e._preCreateElement(n);return t.focus=x.wxinputFocus,t.blur=x.wxinputblur,t.style={},t.value=0,t.parentElement={},t.placeholder={},t.type={},t.setColor=function(n){},t.setType=function(n){},t.setFontFace=function(n){},t.addEventListener=function(n){},t.contains=function(n){return null},t.removeChild=function(n){},t},e.createShaderCondition=function(n){var e=this;return function(){return e[n.replace("this.","")]}},e.EnvConfig=null,e.window=null,e._preCreateElement=null,e._inited=!1,e.wxRequest=null,e.systemInfo=null,e.parseXMLFromString=function(e){var t;e=e.replace(/>\s+</g,"><");try{t=(new n.Parser.DOMParser).parseFromString(e,"text/xml")}catch(n){throw"需要引入xml解析库文件"}return t},e.idx=1,e}(),y=function(){function n(){}o(n,"laya.wx.mini.MiniImage");return n.prototype._loadImage=function(e){F.getFileInfo(e)?n.onCreateImage(e,this,!0):-1!=e.indexOf("http://")||-1!=e.indexOf("https://")?F.downImg(e,new s(n,n.onDownImgCallBack,[e,this]),e):n.onCreateImage(e,this,!0)},n.onDownImgCallBack=function(e,t,i){i?(t.onError(null)):n.onCreateImage(e,t)},n.onCreateImage=function(n,e,t){function i(){r.onload=null,r.onerror=null,delete e.imgCache[n]}void 0===t&&(t=!1);var o;if(t)o=n;else{var a=F.getFileInfo(n).md5;o=F.getFileNativePath(a)}null==e.imgCache&&(e.imgCache={});var r,s=function(){i(),e.onLoaded(r)},d=function(){i(),e.event("error","Load image failed")};"nativeimage"==e._type?((r=new l.window.Image).crossOrigin="",r.onload=s,r.onerror=d,r.src=o,e.imgCache[n]=r):new u.create(o,{onload:s,onerror:d,onCreate:function(t){r=t,e.imgCache[n]=t}})},n}(),x=function(){function e(){}return o(e,"laya.wx.mini.MiniInput"),e._createInputElement=function(){d._initInput(d.area=l.createElement("textarea")),d._initInput(d.input=l.createElement("input")),d.inputContainer=l.createElement("div"),d.inputContainer.style.position="absolute",d.inputContainer.style.zIndex=1e5,l.container.appendChild(d.inputContainer),d.inputContainer.setPos=function(n,e){d.inputContainer.style.left=n+"px",d.inputContainer.style.top=e+"px"},t.stage.on("resize",null,e._onStageResize),wx.onWindowResize&&wx.onWindowResize(function(e){n.dispatchEvent&&n.dispatchEvent("resize")})},e._onStageResize=function(){t.stage._canvasTransform.identity().scale(l.width/f.canvas.width/p.getPixelRatio(),l.height/f.canvas.height/p.getPixelRatio())},e.wxinputFocus=function(n){var e=d.inputElement.target;e&&!e.editable||(w.window.wx.offKeyboardConfirm(),w.window.wx.offKeyboardInput(),w.window.wx.showKeyboard({defaultValue:e.text,maxLength:e.maxChars,multiple:e.multiline,confirmHold:!0,confirmType:"done",success:function(n){},fail:function(n){}}),w.window.wx.onKeyboardConfirm(function(n){var t=n?n.value:"";e.text=t,e.event("input"),laya.wx.mini.MiniInput.inputEnter()}),w.window.wx.onKeyboardInput(function(n){var t=n?n.value:"";e.multiline||-1==t.indexOf("\n")?(e.text=t,e.event("input")):laya.wx.mini.MiniInput.inputEnter()}))},e.inputEnter=function(){d.inputElement.target.focus=!1},e.wxinputblur=function(){e.hideKeyboard()},e.hideKeyboard=function(){w.window.wx.offKeyboardConfirm(),w.window.wx.offKeyboardInput(),w.window.wx.hideKeyboard({success:function(n){console.log("隐藏键盘")},fail:function(n){console.log("隐藏键盘出错:"+(n?n.errMsg:""))}})},e}(),C=function(){function n(){}o(n,"laya.wx.mini.MiniLoader");var e=n.prototype;return e.load=function(e,t,i,o,a){void 0===i&&(i=!0),void 0===a&&(a=!1);this._url=e,0===e.indexOf("data:image")?this._type=t="image":this._type=t||(t=this.getTypeFromUrl(e)),this._cache=i,this._data=null;var l="ascii";-1!=e.indexOf(".fnt")||-1!=e.indexOf("fighter.json")?l="utf8":"arraybuffer"==t&&(l="");var r=_.getFileExtension(e);if(-1!=n._fileTypeArr.indexOf(r))w.EnvConfig.load.call(this,e,t,i,o,a);else if(F.getFileInfo(e))w.EnvConfig.load.call(this,e,t,i,o,a);else{var u=e.split(g.basePath)[0];""==g.basePath&&(u=e),-1!=e.indexOf("http://")||-1!=e.indexOf("https://")?w.EnvConfig.load.call(this,e,t,i,o,a):F.readFile(u,l,new s(n,n.onReadNativeCallBack,[l,e,t,i,o,a,this]),e)}},e.clearRes=function(n,e){void 0===e&&(e=!1);this.clearRes(n,e);var t=F.getFileInfo(n);if(t&&(-1!=n.indexOf("http://")||-1!=n.indexOf("https://"))){var i=t.md5,o=F.getFileNativePath(i);F.remove(o)}},n.onReadNativeCallBack=function(n,e,t,i,o,a,l,r,u){void 0===i&&(i=!0),void 0===a&&(a=!1),void 0===r&&(r=0),r?1==r&&w.EnvConfig.load.call(l,e,t,i,o,a):"json"==t||"atlas"==t?l.onLoaded(w.getJson(u.data)):"xml"==t?l.onLoaded(_.parseXMLFromString(u.data)):l.onLoaded(u.data)},i(n,["_fileTypeArr",function(){return this._fileTypeArr=["png","jpg","bmp","jpeg","gif"]}]),n}(),F=function(n){function e(){e.__super.call(this)}return o(e,"laya.wx.mini.MiniFileMgr",r),e.isLoadFile=function(n){return-1!=e._fileTypeArr.indexOf(n)},e.getFileInfo=function(n){var t=n.split("?")[0],i=e._filesKey[t];return null==i?null:i},e.onFileUpdate=function(n,t){var i=n.split("/"),o=i[i.length-1],a=e.getFileInfo(t);null==a?e.onSaveFile(t,o):a.readyUrl!=t&&e.remove(o,t)},e.exits=function(n,t){var i=e.getFileNativePath(n);e.fs.getFileInfo({filePath:i,success:function(n){null!=t&&t.runWith([0,n])},fail:function(n){null!=t&&t.runWith([1,n])}})},e.read=function(n,t,i,o){void 0===t&&(t="ascill"),void 0===o&&(o="");var a=e.getFileNativePath(n);e.fs.readFile({filePath:a,encoding:t,success:function(n){null!=i&&i.runWith([0,n])},fail:function(n){n&&e.down(o,t,i,o)}})},e.readNativeFile=function(n,t){e.fs.readFile({filePath:n,encoding:"",success:function(n){null!=t&&t.runWith([0])},fail:function(n){null!=t&&t.runWith([1])}})},e.down=function(n,t,i,o){void 0===t&&(t="ascill"),void 0===o&&(o="");var a=e.getFileNativePath(o);e.wxdown({url:n,filePath:a,success:function(n){200===n.statusCode&&e.readFile(n.filePath,t,i,o)},fail:function(n){null!=i&&i.runWith([1,n])}}).onProgressUpdate(function(n){null!=i&&i.runWith([2,n.progress])})},e.readFile=function(n,t,i,o){void 0===t&&(t="ascill"),void 0===o&&(o=""),e.fs.readFile({filePath:n,encoding:t,success:function(t){-1==n.indexOf("http://")&&-1==n.indexOf("https://")||e.onFileUpdate(n,o),null!=i&&i.runWith([0,t])},fail:function(n){n&&null!=i&&i.runWith([1,n])}})},e.downImg=function(n,t,i){void 0===i&&(i="");e.wxdown({url:n,success:function(n){200===n.statusCode&&e.copyFile(n.tempFilePath,i,t)},fail:function(n){null!=t&&t.runWith([1,n])}})},e.copyFile=function(n,t,i){var o=n.split("/"),a=o[o.length-1],l=(t.split("?")[0],e.getFileInfo(t)),r=e.getFileNativePath(a);e.fs.copyFile({srcPath:n,destPath:r,success:function(n){l?l.readyUrl!=t&&e.remove(a,t,i):(e.onSaveFile(t,a),null!=i&&i.runWith([0]))},fail:function(n){null!=i&&i.runWith([1,n])}})},e.getFileNativePath=function(n){return laya.wx.mini.MiniFileMgr.fileNativeDir+"/"+n},e.remove=function(n,i,o){void 0===i&&(i="");var a=e.getFileInfo(i),l=e.getFileNativePath(a.md5);t.loader.clearRes(a.readyUrl),e.fs.unlink({filePath:l,success:function(t){""!=i&&e.onSaveFile(i,n),null!=o&&o.runWith([0])},fail:function(n){}})},e.onSaveFile=function(n,t){var i=n.split("?")[0];e._filesKey[i]={md5:t,readyUrl:n}},e.dir=function(n){e.fs.getSavedFileList({success:function(e){null!=n&&n.runWith([0,e])},fail:function(e){null!=n&&n.runWith([1,e])}})},e.existDir=function(n,t){e.fs.mkdir({dirPath:n,success:function(n){null!=t&&t.runWith([0,n])},fail:function(n){null!=t&&t.runWith([1,n])}})},e.setNativeFileDir=function(n){e.fileNativeDir=wx.env.USER_DATA_PATH+n},e._filesKey={},e.fileNativeDir=null,i(e,["_fileTypeArr",function(){return this._fileTypeArr=["json","ani","xml","sk","txt","atlas","swf","part","fnt","proto","lh","lav","lani","lmat","lm","ltc"]},"fs",function(){return this.fs=wx.getFileSystemManager()},"wxdown",function(){return this.wxdown=wx.downloadFile}]),e}(),E=(function(n){function e(){this._sound=null,this.url=null,this.loaded=!1,e.__super.call(this),this._sound=e._createSound()}o(e,"laya.wx.mini.MiniSound",r);var t=e.prototype;t.load=function(n){function t(){i._sound.onCanplay(null),i._sound.onError(null)}var i=this;if(n=g.formatURL(n),this.url=n,e._audioCache[n])this.event("complete");else{this._sound.src=n,this._sound.onCanplay(function(){t(),o.loaded=!0,o.event("complete"),e._audioCache[o.url]=o});var o=this;this._sound.onError(function(){t(),o.event("error")})}},t.play=function(n,t){void 0===n&&(n=0),void 0===t&&(t=0);var i;this.url==v._musicClass?(e._musicAudio||(e._musicAudio=e._createSound()),i=e._musicAudio):i=e._createSound(),i.src=this.url;var o=new E(i);return o.url=this.url,o.loops=t,o.startTime=n,o.play(),v.addChannel(o),o},t.dispose=function(){var n=e._audioCache[this.url];n&&(n.src="",delete e._audioCache[this.url])},a(0,t,"duration",function(){return this._sound.duration}),e._createSound=function(){return e._id++,w.window.wx.createInnerAudioContext()},e._musicAudio=null,e._id=0,e._audioCache={}}(),function(n){function e(n){this._audio=null,this._onEnd=null,e.__super.call(this),this._audio=n,this._onEnd=_.bind(this.__onEnd,this),n.onEnded(this._onEnd)}o(e,"laya.wx.mini.MiniSoundChannel",h);var i=e.prototype;return i.__onEnd=function(){if(1==this.loops)return this.completeHandler&&(t.timer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event("complete");this.loops>0&&this.loops--,this.startTime=0,this.play()},i.play=function(){this.isStopped=!1,v.addChannel(this),this._audio.play()},i.stop=function(){this.isStopped=!0,v.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.stop(),this._audio.onEnded(null),this._audio=null)},i.pause=function(){this.isStopped=!0,this._audio.pause()},i.resume=function(){this._audio&&(this.isStopped=!1,v.addChannel(this),this._audio.play())},a(0,i,"position",function(){return this._audio?this._audio.currentTime:0}),a(0,i,"duration",function(){return this._audio?this._audio.duration:0}),a(0,i,"volume",function(){return 1},function(n){}),e}())}(window,document,Laya),"function"==typeof define&&define.amd&&define("laya.core",["require","exports"],function(n,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});for(var t in Laya){var i=Laya[t];i&&i.__isclass&&(e[t]=i)}});
